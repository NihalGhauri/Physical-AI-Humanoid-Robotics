# Data Model: RAG Agent for Book Queries

## Core Entities

### Query
**Purpose**: Represents a user's natural language question to the RAG agent

**Attributes**:
- text: string (the question text)
- embedding: float[] (vector representation of the query)
- timestamp: datetime (when the query was submitted)

### RetrievedChunk
**Purpose**: Represents a content chunk retrieved from the knowledge base

**Attributes**:
- chunk_id: string (unique identifier for the chunk)
- content: string (the text content)
- source_url: string (URL of original source)
- page_title: string (title of the source page)
- section_heading: string (heading of the section where content appears)
- chunk_index: int (position of the chunk in the original document)
- score: float (similarity score to the query)
- original_chunk_id: string (original identifier from the ingestion pipeline)

### AgentResponse
**Purpose**: Represents the response generated by the RAG agent

**Attributes**:
- content: string (the agent's answer)
- sources: string[] (list of source URLs used in the response)
- grounded: boolean (whether response is based only on retrieved content)
- retrieved_chunks: RetrievedChunk[] (the chunks that informed the response)

## Relationships

- A **Query** can result in multiple **RetrievedChunk** objects (one-to-many)
- Multiple **RetrievedChunk** objects can inform a single **AgentResponse** (many-to-one)
- An **AgentResponse** references the original **Query** that triggered it

## Validation Rules

### Query Validation
- text must not be empty or null
- text must be a reasonable length (1-1000 characters)
- timestamp must be set when query is created

### RetrievedChunk Validation
- content must not be empty
- source_url must be a valid URL format
- score must be between 0 and 1
- chunk_id must be unique within the system

### AgentResponse Validation
- content must not be empty when grounded is true
- sources must not be empty when grounded is true
- grounded must be false if no relevant chunks were retrieved